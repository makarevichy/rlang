<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quasiquotation of an expression — quasiquotation • rlang</title>

<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Quasiquotation of an expression — quasiquotation" />

<meta property="og:description" content="Quasiquotation is the mechanism that makes it possible to program
flexibly with tidy evaluation grammars like dplyr. It is enabled in
all tidyeval quoting functions, the most fundamental of which are
quo() and expr().
Quasiquotation is the combination of quoting an expression while
allowing immediate evaluation (unquoting) of part of that
expression. We provide both syntactic operators and functional
forms for unquoting.
The !! operator unquotes its argument. It gets evaluated
immediately in the surrounding context.
The !!! operator unquotes and splices its argument. The
argument should represent a list or a vector. Each element will
be embedded in the surrounding call, i.e. each element is
inserted as an argument. If the vector is named, the names are
used as argument names.
If the vector is a classed object (like a factor), it is
converted to a list with base::as.list() to ensure proper
dispatch. If it is an S4 objects, it is converted to a list with
methods::as().
" />

<meta property="og:description" content="Use qq_show() to experiment with quasiquotation or debug the
effect of unquoting operators. qq_show() quotes its input,
processes unquoted parts, and prints the result with
expr_print(). This expression printer has a clearer output than
the base R printer (see the documentation topic)." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quasiquotation of an expression</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/quasiquotation.R'><code>R/quasiquotation.R</code></a></small>
    <div class="hidden name"><code>quasiquotation.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Quasiquotation is the mechanism that makes it possible to program
flexibly with tidy evaluation grammars like dplyr. It is enabled in
all tidyeval quoting functions, the most fundamental of which are
<code><a href='quotation.html'>quo()</a></code> and <code><a href='quotation.html'>expr()</a></code>.</p>
<p>Quasiquotation is the combination of quoting an expression while
allowing immediate evaluation (unquoting) of part of that
expression. We provide both syntactic operators and functional
forms for unquoting.</p><ul>
<li><p>The <code>!!</code> operator unquotes its argument. It gets evaluated
immediately in the surrounding context.</p></li>
<li><p>The <code>!!!</code> operator unquotes and splices its argument. The
argument should represent a list or a vector. Each element will
be embedded in the surrounding call, i.e. each element is
inserted as an argument. If the vector is named, the names are
used as argument names.</p>
<p>If the vector is a classed object (like a factor), it is
converted to a list with <code><a href='http://www.rdocumentation.org/packages/base/topics/list'>base::as.list()</a></code> to ensure proper
dispatch. If it is an S4 objects, it is converted to a list with
<code><a href='http://www.rdocumentation.org/packages/methods/topics/as'>methods::as()</a></code>.</p></li>
</ul>

    <p>Use <code>qq_show()</code> to experiment with quasiquotation or debug the
effect of unquoting operators. <code>qq_show()</code> quotes its input,
processes unquoted parts, and prints the result with
<code><a href='expr_print.html'>expr_print()</a></code>. This expression printer has a clearer output than
the base R printer (see the <a href='expr_print.html'>documentation topic</a>).</p>
    
    </div>

    <pre class="usage"><span class='fu'>qq_show</span>(<span class='no'>expr</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>An expression to be quasiquoted.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="unquoting-names"><a class="anchor" href="#unquoting-names"></a>Unquoting names</h2>

    
    <p>When a function takes multiple named arguments
(e.g. <code>dplyr::mutate()</code>), it is difficult to supply a variable as
name. Since the LHS of <code>=</code> is quoted, giving the name of a variable
results in the argument having the name of the variable rather than
the name stored in that variable. This problem is right up the
alley for the unquoting operator <code>!!</code>. If you were able to unquote
the variable when supplying the name, the argument would be named
after the content of that variable.</p>
<p>Unfortunately R is very strict about the kind of expressions
supported on the LHS of <code>=</code>. This is why we have made the more
flexible <code>:=</code> operator an alias of <code>=</code>. You can use it to supply
names, e.g. <code>a := b</code> is equivalent to <code>a = b</code>. Since its syntax is
more flexible you can unquote on the LHS:</p><pre>name &lt;- "Jane"
    list2(!!name := 1 + 2)
exprs(!!name := 1 + 2)
quos(!!name := 1 + 2)
</pre>
    <p>Like <code>=</code>, the <code>:=</code> operator expects strings or symbols on its LHS.</p>
    
    <h2 class="hasAnchor" id="theory"><a class="anchor" href="#theory"></a>Theory</h2>

    
    <p>Formally, <code><a href='quotation.html'>quo()</a></code> and <code><a href='quotation.html'>expr()</a></code> are quasiquote functions, <code>!!</code> is
the unquote operator, and <code>!!!</code> is the unquote-splice operator.
These terms have a rich history in Lisp languages, and live on in
modern languages like
<a href='https://docs.julialang.org/en/stable/manual/metaprogramming/'>Julia</a>
and
<a href='https://docs.racket-lang.org/reference/quasiquote.html'>Racket</a>.</p>
    
    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    
    <ul>
<li><p>Calling <code>UQ()</code> and <code>UQS()</code> with the rlang namespace qualifier is
deprecated as of rlang 0.3.0. Just use the unqualified forms
instead:</p><pre># Bad
rlang::expr(mean(rlang::UQ(var) * 100))
    # Ok
rlang::expr(mean(UQ(var) * 100))
    # Good
rlang::expr(mean(!!var * 100))
</pre>
    <p>Supporting namespace qualifiers complicates the implementation of
unquotation and is misleading as to the nature of unquoting
operators (which are syntactic operators that operates at
quotation-time rather than function calls at evaluation-time).</p></li>
<li><p><code>UQ()</code> and <code>UQS()</code> were soft-deprecated in rlang 0.2.0 in order
to make the syntax of quasiquotation more consistent. The prefix
forms are now <code>`!!`()</code> and <code>`!!!`()</code> which is
consistent with other R operators (e.g. <code>`+`(a, b)</code> is the
prefix form of <code>a + b</code>).</p>
<p>Note that the prefix forms are not as relevant as before because
<code>!!</code> now has the right operator precedence, i.e. the same as
unary <code>-</code> or <code>+</code>. It is thus safe to mingle it with other
operators, e.g. <code>!!a + !!b</code> does the right thing. In addition the
parser now strips one level of parentheses around unquoted
expressions. This way <code>(!!"foo")(...)</code> expands to <code>foo(...)</code>.
These changes make the prefix forms less useful.</p>
<p>Finally, the named functional forms <code>UQ()</code> and <code>UQS()</code> were
misleading because they suggested that existing knowledge about
functions is applicable to quasiquotation. This was reinforced by
the visible definitions of these functions exported by rlang and
by the tidy eval parser interpreting <code>rlang::UQ()</code> as <code>!!</code>. In
reality unquoting is <em>not</em> a function call, it is a syntactic
operation. The operator form makes it clearer that unquoting is
special.</p></li>
</ul>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Quasiquotation functions quote expressions like base::quote()</span>
<span class='fu'>quote</span>(<span class='fu'>how_many</span>(<span class='no'>this</span>))</div><div class='output co'>#&gt; how_many(this)</div><div class='input'><span class='fu'><a href='quotation.html'>expr</a></span>(<span class='fu'>how_many</span>(<span class='no'>this</span>))</div><div class='output co'>#&gt; how_many(this)</div><div class='input'><span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>how_many</span>(<span class='no'>this</span>))</div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^how_many(this)
#&gt; env:  0x26b91e0</div><div class='input'>
<span class='co'># In addition, they support unquoting. Let's store symbols</span>
<span class='co'># (i.e. object names) in variables:</span>
<span class='no'>this</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span>(<span class='st'>"apples"</span>)
<span class='no'>that</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span>(<span class='st'>"oranges"</span>)

<span class='co'># With unquotation you can insert the contents of these variables</span>
<span class='co'># inside the quoted expression:</span>
<span class='fu'><a href='quotation.html'>expr</a></span>(<span class='fu'>how_many</span>(!!<span class='no'>this</span>))</div><div class='output co'>#&gt; how_many(apples)</div><div class='input'><span class='fu'><a href='quotation.html'>expr</a></span>(<span class='fu'>how_many</span>(!!<span class='no'>that</span>))</div><div class='output co'>#&gt; how_many(oranges)</div><div class='input'>
<span class='co'># You can also insert values:</span>
<span class='fu'><a href='quotation.html'>expr</a></span>(<span class='fu'>how_many</span>(!!(<span class='fl'>1</span> + <span class='fl'>2</span>)))</div><div class='output co'>#&gt; how_many(3)</div><div class='input'><span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>how_many</span>(!!(<span class='fl'>1</span> + <span class='fl'>2</span>)))</div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^how_many(3)
#&gt; env:  0x26b91e0</div><div class='input'>

<span class='co'># Note that when you unquote complex objects into an expression,</span>
<span class='co'># the base R printer may be a bit misleading. For instance compare</span>
<span class='co'># the output of `expr()` and `quo()` (which uses a custom printer)</span>
<span class='co'># when we unquote an integer vector:</span>
<span class='fu'><a href='quotation.html'>expr</a></span>(<span class='fu'>how_many</span>(!!(<span class='fl'>1</span>:<span class='fl'>10</span>)))</div><div class='output co'>#&gt; how_many(1:10)</div><div class='input'><span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>how_many</span>(!!(<span class='fl'>1</span>:<span class='fl'>10</span>)))</div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^how_many(&lt;int: 1L, 2L, 3L, 4L, 5L, ...&gt;)
#&gt; env:  0x26b91e0</div><div class='input'>
<span class='co'># This is why it's often useful to use qq_show() to examine the</span>
<span class='co'># result of unquotation operators. It uses the same printer as</span>
<span class='co'># quosures but does not return anything:</span>
<span class='fu'>qq_show</span>(<span class='fu'>how_many</span>(!!(<span class='fl'>1</span>:<span class='fl'>10</span>)))</div><div class='output co'>#&gt; how_many(&lt;int: 1L, 2L, 3L, 4L, 5L, ...&gt;)</div><div class='input'>

<span class='co'># Use `!!!` to add multiple arguments to a function. Its argument</span>
<span class='co'># should evaluate to a list or vector:</span>
<span class='no'>args</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>mean</span>(!!!<span class='no'>args</span>))</div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^mean(&lt;int: 1L, 2L, 3L&gt;, na.rm = TRUE)
#&gt; env:  0x26b91e0</div><div class='input'>
<span class='co'># You can combine the two</span>
<span class='no'>var</span> <span class='kw'>&lt;-</span> <span class='fu'>quote</span>(<span class='no'>xyz</span>)
<span class='no'>extra_args</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>trim</span> <span class='kw'>=</span> <span class='fl'>0.9</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>mean</span>(!!<span class='no'>var</span> , !!!<span class='no'>extra_args</span>))</div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^mean(xyz, trim = 0.9, na.rm = TRUE)
#&gt; env:  0x26b91e0</div><div class='input'>

<span class='co'># The plural versions have support for the `:=` operator.</span>
<span class='co'># Like `=`, `:=` creates named arguments:</span>
<span class='fu'><a href='quotation.html'>quos</a></span>(<span class='no'>mouse1</span> <span class='kw'>:=</span> <span class='no'>bernard</span>, <span class='kw'>mouse2</span> <span class='kw'>=</span> <span class='no'>bianca</span>)</div><div class='output co'>#&gt; &lt;listof&lt;quosures&gt;&gt;
#&gt; 
#&gt; $mouse1
#&gt; &lt;quosure&gt;
#&gt; expr: ^bernard
#&gt; env:  0x26b91e0
#&gt; 
#&gt; $mouse2
#&gt; &lt;quosure&gt;
#&gt; expr: ^bianca
#&gt; env:  0x26b91e0
#&gt; </div><div class='input'>
<span class='co'># The `:=` is mainly useful to unquote names. Unlike `=` it</span>
<span class='co'># supports `!!` on its LHS:</span>
<span class='no'>var</span> <span class='kw'>&lt;-</span> <span class='st'>"unquote me!"</span>
<span class='fu'><a href='quotation.html'>quos</a></span>(!!<span class='no'>var</span> <span class='kw'>:=</span> <span class='no'>bernard</span>, <span class='kw'>mouse2</span> <span class='kw'>=</span> <span class='no'>bianca</span>)</div><div class='output co'>#&gt; &lt;listof&lt;quosures&gt;&gt;
#&gt; 
#&gt; $`unquote me!`
#&gt; &lt;quosure&gt;
#&gt; expr: ^bernard
#&gt; env:  0x26b91e0
#&gt; 
#&gt; $mouse2
#&gt; &lt;quosure&gt;
#&gt; expr: ^bianca
#&gt; env:  0x26b91e0
#&gt; </div><div class='input'>

<span class='co'># All these features apply to dots captured by enquos():</span>
<span class='no'>fn</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>...</span>) <span class='fu'><a href='quotation.html'>enquos</a></span>(<span class='no'>...</span>)
<span class='fu'>fn</span>(!!!<span class='no'>args</span>, !!<span class='no'>var</span> <span class='kw'>:=</span> <span class='no'>penny</span>)</div><div class='output co'>#&gt; &lt;listof&lt;quosures&gt;&gt;
#&gt; 
#&gt; [[1]]
#&gt; &lt;quosure&gt;
#&gt; expr: ^&lt;int: 1L, 2L, 3L&gt;
#&gt; env:  empty
#&gt; 
#&gt; $na.rm
#&gt; &lt;quosure&gt;
#&gt; expr: ^TRUE
#&gt; env:  empty
#&gt; 
#&gt; $`unquote me!`
#&gt; &lt;quosure&gt;
#&gt; expr: ^penny
#&gt; env:  0x26b91e0
#&gt; </div><div class='input'>

<span class='co'># Unquoting is especially useful for building an expression by</span>
<span class='co'># expanding around a variable part (the unquoted part):</span>
<span class='no'>quo1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>toupper</span>(<span class='no'>foo</span>))
<span class='no'>quo1</span></div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^toupper(foo)
#&gt; env:  0x26b91e0</div><div class='input'>
<span class='no'>quo2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>paste</span>(!!<span class='no'>quo1</span>, <span class='no'>bar</span>))
<span class='no'>quo2</span></div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^paste(^toupper(foo), bar)
#&gt; env:  0x26b91e0</div><div class='input'>
<span class='no'>quo3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='quotation.html'>quo</a></span>(<span class='fu'>list</span>(!!<span class='no'>quo2</span>, !!!<span class='fu'><a href='sym.html'>syms</a></span>(<span class='no'>letters</span>[<span class='fl'>1</span>:<span class='fl'>5</span>])))
<span class='no'>quo3</span></div><div class='output co'>#&gt; &lt;quosure&gt;
#&gt; expr: ^list(^paste(^toupper(foo), bar), a, b, c, d, e)
#&gt; env:  0x26b91e0</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#unquoting-names">Unquoting names</a></li>

      <li><a href="#theory">Theory</a></li>

      <li><a href="#life-cycle">Life cycle</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

